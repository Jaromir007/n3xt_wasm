<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STL Parser</title>
</head>

<body>
    <input type="file" id="stlFile">
    <button onclick="loadSTL()">Load STL</button>

    <script type="module">
        import createModule from "./parser.js";

        let Module;
        createModule().then((m) => {
            Module = m;
            console.log("WASM Loaded");
        });

        async function loadSTL() {
            const fileInput = document.getElementById("stlFile");
            if (fileInput.files.length === 0) {
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function (event) {
                const arrayBuffer = event.target.result;
                const uint8Array = new Uint8Array(arrayBuffer);

                const filename = "uploaded.stl";
                Module.FS.writeFile(filename, uint8Array);

                try {
                    const result = Module.parseSTL(filename);
                    console.log(result);
                } catch (e) {
                    console.error("Error parsing STL:", e);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        window.loadSTL = loadSTL;
    </script>
</body>

</html>